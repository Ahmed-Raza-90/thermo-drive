{% extends "layout.html" %}
{% block content %}
<h2>Graphs & Live Logs</h2>
<div class="row mb-3">
  <div class="col-md-6 card p-3"><h4>Temperature Trend</h4><div id="tempGraph" style="height:300px;"></div></div>
  <div class="col-md-6 card p-3"><h4>Vehicle Trend</h4><div id="vehicleGraph" style="height:300px;"></div></div>
</div>

<div class="card p-3">
<h4>Live Logs</h4>
<table id="logTable" class="table table-bordered table-striped">
<thead><tr><th>Timestamp</th><th>System</th><th>Value</th><th>Status</th></tr></thead>
<tbody></tbody>
</table>
</div>

<script>
function updateGraph(system, div){
    fetch(`/get_logs/${system}`)
    .then(r=>r.json())
    .then(data=>{
        let trace={x:data.times, y:data.values, type:'scatter', mode:'lines+markers', name:system};
        Plotly.newPlot(div,[trace]);
    });
}

function updateLogs(){
    fetch(`/latest_logs`)
    .then(r=>r.json())
    .then(data=>{
        let tbody=document.querySelector("#logTable tbody");
        tbody.innerHTML="";
        data.forEach(row=>{
            let tr=document.createElement("tr");
            row.forEach(col=>{
                let td=document.createElement("td");
                td.innerText=col;
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });
    });
}

// Auto refresh
setInterval(()=>{updateGraph("Temperature","tempGraph"); updateGraph("Vehicle","vehicleGraph"); updateLogs();},3000);
updateGraph("Temperature","tempGraph");
updateGraph("Vehicle","vehicleGraph");
updateLogs();
</script>
{% endblock %}
