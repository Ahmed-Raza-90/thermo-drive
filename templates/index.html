<!DOCTYPE html>
<html>
<head>
    <title>CCP Smart Systems</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; background: #f4f7f9; margin:0; padding:0; }
        .navbar { display:flex; background:#2c3e50; color:white; padding:12px 20px; align-items:center; }
        .navbar a { color:white; padding: 10px 15px; text-decoration:none; font-weight:500; }
        .navbar a:hover { background:#34495e; border-radius:5px; }
        .container { padding:20px; max-width:1200px; margin:auto; }
        .card { background:white; padding:20px; margin-bottom:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
        button { padding: 10px 18px; margin:5px; cursor:pointer; border:none; border-radius:6px; background:#3498db; color:white; font-weight:500; transition:0.2s; }
        button:hover { background:#2980b9; }
        .status { font-weight:bold; font-size:16px; }
        .normal { color:green; }
        .warning { color:orange; }
        .alert { color:red; }
        .cold { color:blue; }
        .footer { position: fixed; left:0; bottom:0; width:100%; text-align:center; padding:10px 0; font-size:14px; color:#000; border-top:1px solid #b3b3b3; background:#dcdcdc; z-index:999; }
        .footer img { width:16px; vertical-align: middle; }
        .hidden { display:none; }
        input[type=number] { padding:6px 10px; width:80px; border-radius:5px; border:1px solid #ccc; margin-left:5px; }
        h1, h2 { margin-top:0; }
        ul { padding-left:20px; }
    </style>
</head>
<body>

<!-- NAVBAR -->
<div class="navbar">
    <a href="#" onclick="showSection('home')">Home</a>
    <a href="#" onclick="showSection('temperature')">Temperature</a>
    <a href="#" onclick="showSection('vehicle')">Vehicle</a>
</div>

<div class="container">

    <!-- HOME -->
    <div id="home">
        <h1>Welcome to CCP Smart Systems</h1>
        <p>This project demonstrates the Temperature Alert System and Vehicle Detection System for smart vehicles.</p>
        <ul>
            <li>Temperature Alert: Auto/Manual read, Threshold-based status, Graphs</li>
            <li>Vehicle Detection: Auto/Manual scan, Safe distance alert, Graphs</li>
            <li>Professional UI with color-coded graphs and status indicators</li>
        </ul>
    </div>

    <!-- TEMPERATURE -->
    <div id="temperature" class="hidden">
        <div class="card">
            <h2>Temperature Alert System</h2>
            Threshold: <input type="number" id="tempThreshold" value="45" min="0">
            <br><br>
            <button onclick="readTemp()">Manual Read</button>
            <button onclick="toggleTempAuto()">Auto Mode</button>
            <p>Temperature: <span id="tempValue">--</span> °C</p>
            <p>Status: <span id="tempStatus" class="status">--</span></p>
            <div id="tempGraph" style="height:350px;"></div>
        </div>
    </div>

    <!-- VEHICLE -->
    <div id="vehicle" class="hidden">
        <div class="card">
            <h2>Vehicle Detection System</h2>
            Safe Distance: <input type="number" id="safeDistance" value="20" min="0">
            <br><br>
            <button onclick="scanVehicle()">Manual Scan</button>
            <button onclick="toggleVehicleAuto()">Auto Mode</button>
            <div id="vehicleOutput" style="margin-top:10px;"></div>
            <div id="vehicleGraph" style="height:350px; margin-top:15px;"></div>
        </div>
    </div>
</div>

<!-- FOOTER -->
<div class="footer">
    Made with ❤️ by
    <a href="https://github.com/Ahmed-Raza-90/" target="_blank" style="color:#000; text-decoration:none;">
        <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"> Ahmed Raza
    </a>
</div>

<script>
let tempAuto=false, tempInterval=null;
let vehicleAuto=false, vehicleInterval=null;

// SECTION NAVIGATION
function showSection(sec){
    document.getElementById('home').classList.add('hidden');
    document.getElementById('temperature').classList.add('hidden');
    document.getElementById('vehicle').classList.add('hidden');
    document.getElementById(sec).classList.remove('hidden');
}

// TEMPERATURE FUNCTIONS
function readTemp(){
    let t=document.getElementById("tempThreshold").value;
    fetch(`/temperature?threshold=${t}`)
    .then(r=>r.json())
    .then(d=>{
        document.getElementById("tempValue").innerText=d.value;
        let s=document.getElementById("tempStatus");
        s.innerText=d.status;
        if(d.status==="TOO COLD") s.className="status cold";
        else s.className="status " + (d.status==="ALERT"?"alert":d.status==="WARNING"?"warning":"normal");
        updateTempGraph();
    });
}

function toggleTempAuto(){
    if(tempInterval) clearInterval(tempInterval);
    tempAuto=!tempAuto;
    if(tempAuto) tempInterval=setInterval(readTemp,2000);
}

function updateTempGraph(){
    fetch("/logs/Temperature")
    .then(r=>r.json())
    .then(d=>{
        let colors = d.statuses.map(s=>s==="TOO COLD"?"blue":s==="ALERT"?"red":s==="WARNING"?"orange":"green");
        Plotly.newPlot("tempGraph", [{y:d.values, marker:{color:colors}, type:"scatter"}], {title:"Temperature Trend"});
    });
}

// VEHICLE FUNCTIONS
function scanVehicle(){
    let s=document.getElementById("safeDistance").value;
    fetch(`/vehicle?safe=${s}`)
    .then(r=>r.json())
    .then(d=>{
        let out="<ul>";
        d.forEach(v=>{
            out+=`<li class="${v.status==="ALERT"?"alert":v.status==="WARNING"?"warning":"normal"}">
            Vehicle ${v.id}: ${v.distance} cm (${v.status})</li>`;
        });
        out+="</ul>";
        document.getElementById("vehicleOutput").innerHTML=out;
        updateVehicleGraph();
    });
}

function toggleVehicleAuto(){
    if(vehicleInterval) clearInterval(vehicleInterval);
    vehicleAuto=!vehicleAuto;
    if(vehicleAuto) vehicleInterval=setInterval(scanVehicle,1500);
}

function updateVehicleGraph(){
    fetch("/logs/Vehicle")
    .then(r=>r.json())
    .then(d=>{
        let colors = d.statuses.map(s=>s==="ALERT"?"red":s==="WARNING"?"orange":"green");
        Plotly.newPlot("vehicleGraph", [{y:d.values, marker:{color:colors}, type:"scatter"}], {title:"Vehicle Distance Trend"});
    });
}

// INIT HOME
showSection('home');
</script>

</body>
</html>
