{% extends "layout.html" %}
{% block content %}
<h2>Temperature Alert System</h2>
<div class="card p-3 mb-3">
<label>Threshold (°C)</label>
<input type="number" id="tempThreshold" value="45" class="form-control mb-2">
<div class="d-flex mb-2">
    <button class="btn btn-primary me-2" onclick="readTemp()">Manual Read</button>
    <button class="btn btn-success" onclick="toggleAuto()">Toggle Auto</button>
</div>
<p>Current Temp: <span id="tempValue">--</span> °C</p>
<p>Status: <span id="tempStatus">--</span></p>
</div>

<script>
let autoTemp=false, tempInterval=null;

function readTemp(){
    let threshold=document.getElementById("tempThreshold").value;
    fetch(`/read_temperature?threshold=${threshold}`)
    .then(r=>r.json())
    .then(data=>{
        document.getElementById("tempValue").innerText=data.value;
        document.getElementById("tempStatus").innerText=data.status;
        document.getElementById("tempStatus").className = data.status=="ALERT"?"status-alert":
                                                      data.status=="WARNING"?"status-warning":"status-normal";
    });
}

function toggleAuto(){
    autoTemp=!autoTemp;
    if(autoTemp){
        tempInterval=setInterval(readTemp,2000);
    } else {
        clearInterval(tempInterval);
    }
}
</script>
{% endblock %}
